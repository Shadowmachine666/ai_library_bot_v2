üéØ –ú–ò–°–°–ò–Ø

–¢—ã ‚Äî Senior Python Architect (FAANG) + RAG Engineer + Telegram Bot Expert.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —É—Å—Ç–æ–π—á–∏–≤—ã–π Telegram-–±–æ—Ç
ai_library_bot, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥
(–¥–æ 50 —Ñ–∞–π–ª–æ–≤ TXT / PDF / EPUB / FB2), –∏—Å–ø–æ–ª—å–∑—É—è Retrieval-Augmented Generation (RAG).

–ë–æ—Ç:

–ø–æ–ª—É—á–∞–µ—Ç –≤–æ–ø—Ä–æ—Å ‚Üí –¥–µ–ª–∞–µ—Ç embeddings ‚Üí –∏—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç LLM ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.

–Ω–∏–∫–∞–∫–∏—Ö –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π, —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–Ω–∏–≥.

üèó –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–ñ–Å–°–¢–ö–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï)

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

ai_library_bot/
  src/
    config.py
    prompts/system_librarian.txt
    ingest_service.py
    retriever_service.py
    analyzer.py
    telegram_bot.py
    formatters.py
    utils.py
    main.py
  tests/
  data/books/
  logs/
  pyproject.toml
  README.md


–ù–∏–∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å.
–õ–æ–≥–∏–∫—É –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å.
–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—ë.

‚öôÔ∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê (–£–ñ–ï–°–¢–û–ß–Å–ù–ù–´–ï)
1. 100% async

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

OpenAI (openai.AsyncOpenAI)

LangChain retriever

Telegram

–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

2. –í–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

–ò—Å–ø–æ–ª—å–∑—É–π:

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç	–í–µ—Ä—Å–∏—è
python-telegram-bot	21.0+
LangChain	0.2+
OpenAI SDK	1.35+ (async)
FAISS	–ª–æ–∫–∞–ª—å–Ω—ã–π index, simple
ebooklib	–¥–ª—è epub/fb2
PyPDF2	PDF (—á–µ—Ä–µ–∑ executor ‚Äî –æ–Ω sync)
3. Vector Store

FAISS (–ª–æ–∫–∞–ª—å–Ω–æ)

async-–æ–±—ë—Ä—Ç–∫–∏ —á–µ—Ä–µ–∑ run_in_executor –≥–¥–µ –Ω—É–∂–Ω–æ

embeddings –±–∞—Ç—á–∞–º–∏ 128‚Äì256

4. Chunking
chunk_size = 1500‚Äì2000 —Å–∏–º–≤–æ–ª–æ–≤
chunk_overlap = 200

5. –ö—ç—à

aiocache ‚Äî TTL = 1 —á–∞—Å –¥–ª—è retrieval.

üîç RAG PIPELINE (–õ–ê–ö–û–ù–ò–ß–ù–û, –ù–û –ñ–Å–°–¢–ö–û)
ingest_service.py

–§—É–Ω–∫—Ü–∏—è:

async def ingest_books(folder_path: str) -> None:


–î–æ–ª–∂–Ω–∞:

–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã

–∏–∑–≤–ª–µ—á—å title/author

—Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞–Ω–∫–∏

—Å–¥–µ–ª–∞—Ç—å embeddings (batch)

—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ FAISS index + metadata

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

—Ñ–∞–π–ª ‚â§ 20 MB

PDF ‚â§ 500 —Å—Ç—Ä–∞–Ω–∏—Ü

–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–∞–Ω–∫–∏ < 200 —Å–∏–º–≤–æ–ª–æ–≤

retriever_service.py
async def get_retriever()
async def retrieve_chunks(query: str)


embed –∑–∞–ø—Ä–æ—Å–∞

top-k = 10

score threshold = 0.7

–µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö ‚Üí NOT_FOUND

analyzer.py

Custom chain:

system_prompt + —á–∞–Ω–∫–∏

–º–æ–¥–µ–ª—å: gpt-4o-mini –∏–ª–∏ gpt-4o

—Å—Ç—Ä–æ–≥–∏–π JSON output (–≤–∞–ª–∏–¥–Ω—ã–π)

ü§ñ SYSTEM PROMPT (system_librarian.txt)

–ü–æ–ª–æ–∂–∏—Ç—å –¥–æ—Å–ª–æ–≤–Ω–æ:

–¢—ã ‚Äî AI-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞.  
–ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

–ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Üí "status": "NOT_FOUND"  
–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π ‚Üí "status": "CLARIFICATION_NEEDED"  
–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç ‚Üí "status": "CONFLICT"

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å—Ç—Ä–æ–≥–æ JSON:
{
  "status": "...",
  "clarification_question": "...",
  "result": {
    "answer": "...",
    "quotes": [
      {"text": "...", "source": "–ù–∞–∑–≤–∞–Ω–∏–µ, —Å—Ç—Ä–∞–Ω–∏—Ü–∞/–≥–ª–∞–≤–∞"}
    ],
    "disclaimer": "–≠—Ç–æ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤."
  }
}

üì® TELEGRAM FLOW (telegram_bot.py)

/start ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

–ª—é–±–æ–π —Ç–µ–∫—Å—Ç ‚Üí –≤–æ–ø—Ä–æ—Å

–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à

retrieval

–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å NOT_FOUND

analyzer ‚Üí strict JSON

formatters ‚Üí –∫—Ä–∞—Å–∏–≤—ã–π markdown

–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

Application.builder().token(TG_TOKEN).build()

üß™ –¢–ï–°–¢–´

–ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏:

ingest_books

retrieve_chunks

analyzer (mock OpenAI)

telegram handlers (mock PTB)

–ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ –∑–∞–ø—Ä–æ—Å–∞

Async-—Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑:

pytest.mark.asyncio

üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —á–∞–Ω–∫–∏

–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É user query

OpenAI retries (5 –ø–æ–ø—ã—Ç–æ–∫, —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

—Å–∫—Ä—ã–≤–∞—Ç—å –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ .env

–Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–Ω–∏–≥

üßº –ö–û–î-–°–¢–ê–ô–õ

ruff, black

mypy --strict

pydantic v2 –¥–ª—è JSON —Å—Ö–µ–º—ã

–∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–¥, –±–µ–∑ –∑–∞–≥–ª—É—à–µ–∫

üß© –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï CURSOR

Cursor –¥–æ–ª–∂–µ–Ω:

–°–æ–∑–¥–∞—Ç—å –í–°–Æ —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–í –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ ‚Äî —Ç–æ–ª—å–∫–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async everywhere.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫.

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π MVP.