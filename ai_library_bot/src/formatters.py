"""–§–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è ai_library_bot.

–ü—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –≤ –∫—Ä–∞—Å–∏–≤—ã–µ Markdown —Å–æ–æ–±—â–µ–Ω–∏—è
–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ Telegram.
"""

from src.analyzer import AnalysisResponse, Result
from src.utils import setup_logger

logger = setup_logger(__name__)


def format_response(response: AnalysisResponse) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –≤ Markdown —Ç–µ–∫—Å—Ç.

    Args:
        response: –û–±—ä–µ–∫—Ç AnalysisResponse –æ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ Markdown –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    """
    if response.status == "NOT_FOUND":
        return format_not_found()

    if response.status == "CLARIFICATION_NEEDED":
        return format_clarification_needed(response.clarification_question)

    if response.status == "CONFLICT":
        return format_conflict(response)

    if response.status == "SUCCESS" and response.result:
        return format_success(response.result)

    # Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    logger.warning(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {response.status}")
    return "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞."


def format_not_found() -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

    Returns:
        Markdown —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    return """‚ùå **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞**

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏,
–æ—Ç–≤–µ—á–∞—é—â–µ–π –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å.

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç—å –µ–≥–æ."""


def format_clarification_needed(question: str | None) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π —É—Ç–æ—á–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å.

    Args:
        question: –í–æ–ø—Ä–æ—Å –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å None).

    Returns:
        Markdown —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    if question:
        return f"""‚ùì **–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ**

{question}

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å, —á—Ç–æ–±—ã —è –º–æ–≥ –Ω–∞–π—Ç–∏
–Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö."""

    return """‚ùì **–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ**

–í–∞—à –≤–æ–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –µ–≥–æ,
—á—Ç–æ–±—ã —è –º–æ–≥ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö."""


def format_conflict(response: AnalysisResponse) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –¥–∞–Ω–Ω—ã—Ö.

    Args:
        response: –û–±—ä–µ–∫—Ç AnalysisResponse —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º CONFLICT.

    Returns:
        Markdown —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    return """‚ö†Ô∏è **–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –¥–∞–Ω–Ω—ã—Ö**

–í –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö –Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–ø–æ –≤–∞—à–µ–º—É –≤–æ–ø—Ä–æ—Å—É.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫,
–∫–æ—Ç–æ—Ä—ã–π –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç."""


def format_success(result: Result) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∞–Ω–∞–ª–∏–∑–∞.

    Args:
        result: –û–±—ä–µ–∫—Ç Result —Å –æ—Ç–≤–µ—Ç–æ–º –∏ —Ü–∏—Ç–∞—Ç–∞–º–∏.

    Returns:
        Markdown —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    lines = ["‚úÖ **–û—Ç–≤–µ—Ç:**\n"]

    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç
    lines.append(f"{result.answer}\n")

    # –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ç–∞—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å
    if result.quotes:
        lines.append("\nüìö **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**\n")
        for i, quote in enumerate(result.quotes, 1):
            lines.append(f"{i}. _{quote.text}_")
            lines.append(f"   üìñ {quote.source}\n")

    # –î–æ–±–∞–≤–ª—è–µ–º –¥–∏—Å–∫–ª–µ–π–º–µ—Ä
    if result.disclaimer:
        lines.append(f"\n_{result.disclaimer}_")

    return "\n".join(lines)


def format_start_message() -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /start.

    Returns:
        Markdown —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.
    """
    return """üëã **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AI-–±–∏–±–ª–∏–æ—Ç–µ–∫—É!**

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∞—Ö.

–ü—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π—Ç–µ –º–Ω–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –Ω–∞–π–¥—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
–∏–∑ –≤–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –¥–∞–º –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
‚Ä¢ –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?
‚Ä¢ –†–∞—Å—Å–∫–∞–∂–∏ –æ Python
‚Ä¢ –ö–∞–∫–∏–µ –µ—Å—Ç—å –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏?

–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å! üìö"""
