# Демонстрация работы ai_library_bot (E2E Dry-Run)

Этот документ описывает пошаговую демонстрацию работы бота в mock-режиме.

## Предварительные требования

- Python 3.11 или выше
- Виртуальное окружение настроено
- Все зависимости установлены

## Шаг 1: Подготовка .env файла

Создайте файл `.env` в директории `ai_library_bot/`:

```bash
cd ai_library_bot
cp .env.example .env
```

Отредактируйте `.env` файл:

```env
# Telegram Bot Token (можно использовать mock значение для тестирования)
TG_TOKEN=mock_telegram_token_for_testing

# OpenAI API Key (можно использовать mock значение для тестирования)
OPENAI_API_KEY=mock_openai_key_for_testing

# Путь к FAISS индексу
FAISS_PATH=./data/index.faiss

# Backend для кэша (memory для тестирования)
CACHE_BACKEND=memory

# Уровень логирования
LOG_LEVEL=INFO
```

**Примечание:** В mock-режиме реальные токены не используются, но они должны быть указаны для корректной работы конфигурации.

## Шаг 2: Подготовка mock книг

Создайте директорию для книг (если её ещё нет):

```bash
mkdir -p data/books
```

Создайте 2 тестовых текстовых файла:

**Файл 1: `data/books/book1.txt`**

```
Введение в Python

Python - это высокоуровневый язык программирования, который был создан Гвидо ван Россумом в 1991 году.
Python известен своей простотой и читаемостью кода. Он широко используется для веб-разработки,
научных вычислений, анализа данных и искусственного интеллекта.

Основные особенности Python:
- Динамическая типизация
- Автоматическое управление памятью
- Большая стандартная библиотека
- Поддержка множественного наследования

Python поддерживает несколько парадигм программирования: объектно-ориентированное, функциональное
и процедурное программирование.
```

**Файл 2: `data/books/book2.txt`**

```
Машинное обучение для начинающих

Машинное обучение (Machine Learning) - это подраздел искусственного интеллекта, который позволяет
компьютерам обучаться на данных без явного программирования.

Основные типы машинного обучения:
1. Обучение с учителем (Supervised Learning) - алгоритм обучается на размеченных данных
2. Обучение без учителя (Unsupervised Learning) - алгоритм находит паттерны в данных без меток
3. Обучение с подкреплением (Reinforcement Learning) - алгоритм обучается через взаимодействие со средой

Популярные алгоритмы машинного обучения включают:
- Линейная регрессия
- Деревья решений
- Случайный лес
- Нейронные сети
- Метод опорных векторов

Для работы с машинным обучением в Python часто используются библиотеки:
scikit-learn, TensorFlow, PyTorch, Keras.
```

## Шаг 3: Загрузка книг в индекс (Ingestion)

Запустите команду для загрузки книг:

```bash
# Активируйте виртуальное окружение (если ещё не активировано)
.venv\Scripts\activate.bat  # Windows
# или
source .venv/bin/activate  # Linux/macOS

# Перейдите в директорию проекта
cd ai_library_bot

# Запустите ingestion
python -m src.main ingest --folder data/books
```

**Ожидаемый вывод (mock):**

```
2024-01-15 10:30:00 - src.ingest_service - INFO - Начало обработки книг из папки: data/books
2024-01-15 10:30:00 - src.ingest_service - INFO - Найдено файлов: 2
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Обработка файла: book1.txt
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Чтение TXT файла data/books/book1.txt
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Извлечение метаданных из data/books/book1.txt
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Разбиение на чанки: 3 чанка
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Создание эмбеддингов для 3 чанков
2024-01-15 10:30:01 - src.ingest_service - DEBUG - MOCK: Сохранение в FAISS
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Обработка файла: book2.txt
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Чтение TXT файла data/books/book2.txt
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Извлечение метаданных из data/books/book2.txt
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Разбиение на чанки: 4 чанка
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Создание эмбеддингов для 4 чанков
2024-01-15 10:30:02 - src.ingest_service - DEBUG - MOCK: Сохранение в FAISS
2024-01-15 10:30:02 - src.ingest_service - INFO - Обработка завершена. Обработано файлов: 2
```

## Шаг 4: Запуск бота в mock mode

Запустите бота:

**ВАЖНО:** Команда должна запускаться из директории `ai_library_bot`!

```powershell
# Из корневой директории проекта:

# 1. Перейдите в директорию ai_library_bot
cd ai_library_bot

# 2. Запустите бота
python -m src.main run
```

**Или одной командой:**
```powershell
cd ai_library_bot; python -m src.main run
```

**Примечание:** Убедитесь, что вы находитесь в директории `ai_library_bot` перед запуском команды.

**Ожидаемый вывод:**

```
2024-01-15 10:35:00 - src.telegram_bot - INFO - Бот запущен и готов к работе
2024-01-15 10:35:00 - src.telegram_bot - INFO - Ожидание сообщений...
```

Бот запущен и готов к работе. В mock-режиме он будет обрабатывать запросы, но использовать mock-данные для ответов.

## Шаг 5: Пример запроса и ответа (Mock)

### Сценарий 1: Успешный запрос

**Пользователь отправляет в Telegram:**
```
Что такое Python?
```

**Ожидаемый ответ бота (mock):**

```
✅ **Ответ:**

Python - это высокоуровневый язык программирования, который был создан Гвидо ван Россумом в 1991 году.
Python известен своей простотой и читаемостью кода.

**Источники:**
• book1.txt, страница 1

---
*Это анализ на основе загруженных текстов.*
```

**Логи бота:**
```
2024-01-15 10:36:15 - src.telegram_bot - INFO - Запрос от пользователя 12345: Что такое Python?
2024-01-15 10:36:15 - src.telegram_bot - INFO - MOCK: Поиск релевантных чанков для запроса
2024-01-15 10:36:15 - src.telegram_bot - INFO - MOCK: Найдено 3 релевантных чанка
2024-01-15 10:36:15 - src.analyzer - INFO - MOCK: Анализ чанков через LLM
2024-01-15 10:36:16 - src.telegram_bot - INFO - Ответ успешно отправлен пользователю 12345
```

### Сценарий 2: Запрос без информации

**Пользователь отправляет:**
```
Как работает квантовая физика?
```

**Ожидаемый ответ бота (mock):**

```
❌ **Информация не найдена**

К сожалению, в загруженных книгах не найдено информации,
отвечающей на ваш вопрос.

Попробуйте переформулировать вопрос или уточнить его.
```

**Логи бота:**
```
2024-01-15 10:37:20 - src.telegram_bot - INFO - Запрос от пользователя 12345: Как работает квантовая физика?
2024-01-15 10:37:20 - src.telegram_bot - WARNING - Не найдено релевантных чанков для запроса: Как работает квантовая физика?
```

### Сценарий 3: Запрос, требующий уточнения

**Пользователь отправляет:**
```
Расскажи про программирование
```

**Ожидаемый ответ бота (mock):**

```
❓ **Требуется уточнение**

Ваш вопрос слишком общий. Пожалуйста, уточните его,
чтобы я мог найти нужную информацию в загруженных книгах.

Например:
- Какой язык программирования вас интересует?
- Что именно вы хотите узнать о программировании?
```

**Логи бота:**
```
2024-01-15 10:38:10 - src.telegram_bot - INFO - Запрос от пользователя 12345: Расскажи про программирование
2024-01-15 10:38:10 - src.analyzer - INFO - MOCK: LLM вернул статус CLARIFICATION_NEEDED
```

### Сценарий 4: Запрос о машинном обучении

**Пользователь отправляет:**
```
Какие типы машинного обучения существуют?
```

**Ожидаемый ответ бота (mock):**

```
✅ **Ответ:**

Существует три основных типа машинного обучения:

1. **Обучение с учителем (Supervised Learning)** - алгоритм обучается на размеченных данных
2. **Обучение без учителя (Unsupervised Learning)** - алгоритм находит паттерны в данных без меток
3. **Обучение с подкреплением (Reinforcement Learning)** - алгоритм обучается через взаимодействие со средой

**Источники:**
• book2.txt, страница 1

---
*Это анализ на основе загруженных текстов.*
```

## Шаг 6: Остановка бота

Для остановки бота нажмите `Ctrl+C` в терминале:

```
^C
2024-01-15 10:40:00 - src.telegram_bot - INFO - Получен сигнал остановки...
2024-01-15 10:40:00 - src.telegram_bot - INFO - Бот остановлен
```

## Полный пример end-to-end диалога (Mock)

```
=== Запуск бота ===
$ python -m src.main run
2024-01-15 10:35:00 - INFO - Бот запущен и готов к работе

=== Пользователь: /start ===
Бот: Привет! Я AI-библиотекарь.

Я помогу вам найти информацию в загруженных книгах.

Просто задайте мне вопрос, и я найду релевантные фрагменты
из вашей библиотеки и дам ответ на основе этих данных.

=== Пользователь: Что такое Python? ===
Бот: ✅ **Ответ:**

Python - это высокоуровневый язык программирования...

**Источники:**
• book1.txt, страница 1

---
*Это анализ на основе загруженных текстов.*

=== Пользователь: Какие библиотеки используются для машинного обучения? ===
Бот: ✅ **Ответ:**

Для работы с машинным обучением в Python часто используются библиотеки:
scikit-learn, TensorFlow, PyTorch, Keras.

**Источники:**
• book2.txt, страница 1

---
*Это анализ на основе загруженных текстов.*

=== Пользователь: Как работает квантовая физика? ===
Бот: ❌ **Информация не найдена**

К сожалению, в загруженных книгах не найдено информации,
отвечающей на ваш вопрос.

Попробуйте переформулировать вопрос или уточнить его.

=== Остановка бота ===
^C
2024-01-15 10:40:00 - INFO - Бот остановлен
```

## Проверка работы

### Проверка индекса

```bash
# Проверьте, что индекс создан
ls -lh data/index.faiss

# В mock-режиме файл может не существовать физически,
# но логика будет работать с mock-данными
```

### Проверка логов

```bash
# Просмотрите логи
tail -f logs/ai_library_bot_*.log

# Или в Windows PowerShell
Get-Content logs\ai_library_bot_*.log -Tail 50 -Wait
```

## Примечания

1. **Mock-режим:** В текущей реализации все внешние вызовы (OpenAI, FAISS, Telegram) мокируются. Реальные API не используются.

2. **Тестовые данные:** Используйте простые текстовые файлы для тестирования. В production можно использовать PDF, EPUB, FB2.

3. **Логи:** Все действия логируются в файлы в директории `logs/`.

4. **Конфигурация:** Убедитесь, что файл `.env` настроен правильно перед запуском.

## Следующие шаги

После успешной демонстрации в mock-режиме:

1. Настройте реальные токены в `.env` файле
2. Загрузите реальные книги в `data/books/`
3. Запустите ingestion с реальными данными
4. Запустите бота в production режиме

Подробнее см.:
- `docs/run_local.md` - инструкции по локальному запуску
- `docs/deploy.md` - инструкции по развёртыванию в production

