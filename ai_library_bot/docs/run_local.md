# Инструкции по локальному запуску ai_library_bot

Этот документ описывает, как запустить бота локально на вашем компьютере.

## Требования

- Python 3.11 или выше
- pip (менеджер пакетов Python)
- Git (для клонирования репозитория)

## Шаг 1: Клонирование репозитория

```bash
git clone <URL_РЕПОЗИТОРИЯ>
cd ai_library_bot
```

## Шаг 2: Создание виртуального окружения

### Windows (PowerShell):

```powershell
# Создание виртуального окружения
python -m venv .venv

# Активация (вариант 1 - через .bat)
.venv\Scripts\activate.bat

# Активация (вариант 2 - через Python напрямую)
.venv\Scripts\python.exe -m pip install ...
```

### Linux/macOS:

```bash
# Создание виртуального окружения
python3 -m venv .venv

# Активация
source .venv/bin/activate
```

## Шаг 3: Установка зависимостей

```bash
# Обновление pip
python -m pip install --upgrade pip

# Установка основных зависимостей
pip install -r requirements.txt

# Установка зависимостей для разработки (опционально)
pip install -r requirements-dev.txt
```

## Шаг 4: Настройка переменных окружения

1. Скопируйте файл `.env.example` в `.env`:

```bash
cp .env.example .env
```

2. Откройте файл `.env` и заполните необходимые переменные:

```env
TG_TOKEN=ваш_токен_telegram_бота
OPENAI_API_KEY=ваш_ключ_openai
FAISS_PATH=./data/index.faiss
CACHE_BACKEND=memory
LOG_LEVEL=INFO
```

### Как получить токен Telegram бота:

1. Откройте Telegram и найдите бота [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и получите токен
4. Вставьте токен в `.env` файл

### Как получить ключ OpenAI:

1. Зарегистрируйтесь на [platform.openai.com](https://platform.openai.com)
2. Перейдите в раздел API Keys
3. Создайте новый ключ
4. Вставьте ключ в `.env` файл

## Шаг 5: Подготовка данных

Создайте папку для книг (если её ещё нет):

```bash
mkdir -p data/books
```

Поместите ваши книги в форматах TXT, PDF, EPUB или FB2 в папку `data/books/`.

**Ограничения:**
- Максимум 50 файлов
- Максимальный размер файла: 20 МБ
- Максимальное количество страниц в PDF: 500

## Шаг 6: Загрузка книг в индекс (Ingestion)

Перед запуском бота необходимо загрузить книги в векторный индекс:

```bash
python -m src.main ingest --folder data/books
```

Эта команда:
- Прочитает все поддерживаемые файлы из папки `data/books/`
- Разобьёт их на чанки
- Создаст эмбеддинги
- Сохранит индекс в FAISS

## Шаг 7: Запуск бота

```bash
python -m src.main run
```

Бот запустится и начнёт обрабатывать сообщения от пользователей.

## Проверка работы

1. Откройте Telegram
2. Найдите вашего бота по имени
3. Отправьте команду `/start`
4. Задайте вопрос о загруженных книгах

## Остановка бота

Нажмите `Ctrl+C` в терминале, где запущен бот.

## Режим разработки (Mock Mode)

Для тестирования без реальных API можно использовать mock-режим:

```bash
# Установите переменную окружения
export MOCK_MODE=true  # Linux/macOS
# или
$env:MOCK_MODE="true"  # Windows PowerShell

# Запустите бота
python -m src.main run
```

В mock-режиме:
- Все вызовы к OpenAI будут мокироваться
- FAISS будет использовать mock-данные
- Telegram бот будет работать, но ответы будут генерироваться на основе mock-данных

## Устранение проблем

### Ошибка: "ModuleNotFoundError"

Убедитесь, что виртуальное окружение активировано и все зависимости установлены:

```bash
pip install -r requirements.txt
```

### Ошибка: "TG_TOKEN не установлен"

Проверьте, что файл `.env` существует и содержит правильный токен.

### Ошибка: "FAISS index not found"

Запустите ingestion перед запуском бота:

```bash
python -m src.main ingest --folder data/books
```

### Ошибка при чтении PDF

Убедитесь, что PDF файл:
- Не повреждён
- Имеет меньше 500 страниц
- Имеет размер меньше 20 МБ

## Логи

Логи сохраняются в папке `logs/`. Уровень логирования настраивается через переменную `LOG_LEVEL` в `.env` файле.

Доступные уровни:
- `DEBUG` - подробная информация для отладки
- `INFO` - общая информация о работе
- `WARNING` - предупреждения
- `ERROR` - только ошибки

## Дополнительная информация

- Подробнее о метриках: см. `docs/metrics.md`
- Инструкции по развёртыванию: см. `docs/deploy.md`
- Операционные процедуры: см. `docs/ops.md` (будет создан на Шаге 9)






